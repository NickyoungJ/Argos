[프로젝트 PRD] Restock Alert (재입고 알림 서비스)1. 프로젝트 개요 (Project Overview)서비스명: Restock Alert (코드명: EagleEye)비전: 사용자가 반복적인 새로고침(F5)을 할 필요 없이, 상품의 재입고나 가격 변동을 가장 빠르게 감지하여 알려주는 자동화 인프라를 구축한다.핵심 원칙 (AI 준수 사항 - Strict Constraints):자동 결제 금지 (NO Auto-Checkout): 이 시스템은 오직 "모니터링"과 "알림"만 수행한다. 절대 자동 구매나 장바구니 담기 기능을 구현하지 않는다.트래픽 안전 및 봇 탐지 회피 (Traffic Safety): 대상 사이트의 서버 부하를 막고 차단을 피하기 위해 모든 요청 사이에 **랜덤 딜레이(Random Delay)**를 필수적으로 적용한다.가치 제안:Visual Mode: 화면의 픽셀/DOM 변화 감지 (저비용, 일반 유저용).Semantic Mode (AI): GPT를 통해 특정 옵션(예: "270 사이즈", "빨간색")의 재입고 여부를 정확히 판단 (고부가가치, Pro 유저용).2. 기술 스택 (Tech Stack)Cursor는 반드시 아래 기술 스택을 사용하여 코드를 작성해야 한다.프레임워크: Next.js 14 (App Router)언어: TypeScript스타일링: Tailwind CSS + Shadcn/UI데이터베이스: Supabase (PostgreSQL)인증 (Auth): Supabase Auth (이메일 + 전화번호 인증 필수)스크래핑 엔진:Playwright (Headless Browser)puppeteer-extra-plugin-stealth (봇 탐지 회피 플러그인)AI 분석: OpenAI API (gpt-4o-mini)작업 큐 (Scheduling): Inngest (서버리스 이벤트 큐)알림 (Notification):Solapi (CoolSMS) (카카오 알림톡/SMS 발송 - 한국 타겟 핵심)Resend (이메일 발송 - 보조 수단)3. 요금제 및 할당량 정책 (Pricing & Quota Policy)중요: API 및 미들웨어 레벨에서 아래의 등급별 제한을 엄격하게 체크하는 로직을 구현해야 한다.기능Free TierStandard TierPro Tier최대 등록 URL1개10개30개최소 감시 주기30분5분1분감시 모드Visual 전용Visual 전용Visual + Semantic (AI)AI 크레딧00월 1,000 크레딧알림 채널이메일이메일 + 카카오톡이메일 + 카카오톡4. 데이터베이스 스키마 (Draft Reference)Note for Cursor: 아래 스키마는 비즈니스 로직(필수 저장 데이터)을 설명하기 위한 **참조용(Draft)**입니다. Cursor는 이 요구사항을 충족하되, Supabase와 Prisma(선택 시) 환경에 맞춰 가장 최적화된 형태(Indexing, Relations 등)로 설계하세요.users 테이블 (사용자 정보)id: UUID (PK)email: Stringphone_number: String (카카오톡 발송을 위해 인증된 번호, Unique)tier: Enum (FREE, STANDARD, PRO)credits: Integer (AI 분석 시 차감되는 재화)created_at: Timestampmonitors 테이블 (사용자가 등록한 감시 작업)id: UUID (PK)user_id: UUID (FK)url: String (대상 사이트 주소)product_name: String (상품명)target_option: String (Nullable. 예: "사이즈 270". AI 분석의 핵심 기준)mode: Enum (VISUAL, SEMANTIC)frequency: Integer (분 단위)is_active: Booleanlast_checked_at: Timestampfail_count: Integer (연속 실패 횟수 감지용)logs 테이블 (감시 이력)id: UUIDmonitor_id: UUID (FK)status: Enum (CHANGED, UNCHANGED, ERROR)message: String (예: "재입고 감지됨", "가격 50,000원으로 변경")created_at: Timestamp5. 핵심 기능 명세 (Core Logic Specifications)A. 스크래퍼 엔진 (The "Worker")랜덤 딜레이 (Random Delay): 모든 요청을 보내기 전, 2초에서 10초 사이의 무작위 시간을 대기한다. (봇 차단 방지 핵심)User-Agent 로테이션: 매 요청마다 브라우저 정보를 변경하여 일반 사용자인척 한다.타임아웃: 요청당 최대 대기 시간은 30초로 제한한다.B. Semantic AI 분석 (Pro 기능)입력: HTML 텍스트 + 사용자의 target_option.프로세스:Playwright로 HTML 로드.전처리 (Pre-processing): script, style, svg, 주석 등을 제거하여 토큰 사용량을 90% 이상 절감.AI 요청 (gpt-4o-mini):프롬프트: "이 상품 페이지를 분석해. 사용자가 원하는 옵션은 '{target_option}'이야. 다음 JSON으로 답해: { is_restocked: boolean, price: number, option_available: boolean }."크레딧 차감: 유저의 credits를 1 차감. 잔여 크레딧 부족 시 Visual Mode로 자동 전환.C. Visual 분석 (기본 기능)프로세스:DOM 텍스트 해시(Hash) 또는 스크린샷 캡처.이전 스냅샷과 비교.변화 감지 시 알림 트리거.D. 알림 발송 시스템우선순위: 카카오 알림톡(Solapi) -> 실패 시 SMS -> 최후수단 이메일.메시지 템플릿:[재입고 알림]상품명: {product_name}옵션: {target_option}시간: {current_time}바로가기: {url}6. 개발 로드맵 (Development Roadmap)Phase 1: 환경 설정 및 인증 (Environment & Auth)Next.js 14 프로젝트 생성.Supabase Auth 연동 (이메일 + 전화번호 인증 UI 구현).DB 테이블 생성 (users, monitors - 위 참조 스키마 기반 최적화).Phase 2: 스크래퍼 엔진 구현 (Core Engine)/lib/scraper.ts 구현.랜덤 딜레이와 Stealth Plugin이 적용된 fetchHtml() 함수 개발.토큰 절약을 위한 cleanHtml() 함수 개발.더미 페이지를 대상으로 AI 파싱 테스트 진행.Phase 3: 스케줄링 및 큐 (Scheduling)Inngest 설정 및 함수 등록.사용자의 설정 주기(1분, 5분, 30분)에 따라 작동하는 Cron Job 구현.스크래퍼 엔진을 큐 시스템과 연결.Phase 4: 비즈니스 로직 및 UIPOST /api/monitor API 구현: 요금제별 제한(Quota) 체크 로직 필수.대시보드 UI 개발 (모니터링 목록, 추가 모달).결제/등급 관련 목업(Mock) 로직 구현.Phase 5: 알림 시스템 (Notification)Solapi API 연동.실제 감지 성공 시 카카오톡 메시지가 오는지 테스트.